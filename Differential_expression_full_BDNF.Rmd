---
title: "Differential_expression_full_BDNF"
author: "Maddie Lombardo"
date: "1/11/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(annotables)
library(tidyverse)
```

read in the files
```{r}
featureCounts_file_path <- file.path(here::here(),"data","feature_counts_bdnf_full_experiment")

res <- run_standard_deseq(featureCounts_file_path,
                   base_grep = "CONTROL",
                   contrast_grep = "BDNF",
                   grep_pattern = "1hr",
                   baseName = "control",
                   contrastName = 'bdnf')


meta_file_path <- file.path(here::here(),"data", "full_experiment_metadata.csv")

metadata <- fread(meta_file_path)

```
read in functions
```{r}
source(here::here('make_volcano_plot.R'))
```

first, do a PCA plot of all samples
```{r}
featureCounts_file_path <- file.path(here::here(),"data","feature_counts_bdnf_full_experiment")
counts_object <- create_feature_count_table(featureCounts_file_path)

#remove the gene name column, turn it into a rowname
counts_object <- counts_object %>% 
    select(-gene_name) %>% 
    column_to_rownames('Geneid') 

meta_df <- metadata %>% 
  mutate(well = as.factor(well)) %>% #turn it into a factor so when you color by it with the biplot function it doesn't give you a gradient
    column_to_rownames('sample_name')

#reorder the columns of counts object to match the order of the rows in meta_df
counts_object <- counts_object[match(rownames(meta_df),colnames(counts_object))]

library(PCAtools)
p <- PCAtools::pca(counts_object , metadata = meta_df, removeVar = 0.1)

screeplot <- screeplot(p, axisLabSize = 18, titleLabSize = 22)

biplot(p,
       x = "PC1",
       y = "PC2",
       colby = 'cond')
```


make volcano plot

```{r}
make_volcano_plot(res)
```

